VERSION 0.8

IMPORT ./rust AS rust
IMPORT ./image AS image

ci:
    BUILD rust+fmt
    BUILD rust+clippy
    BUILD rust+test

sbom:
    FROM rust:1.84
    WORKDIR /app
    RUN cargo install cargo-cyclonedx
    COPY Cargo.toml Cargo.lock .
    RUN cargo cyclonedx --format json > sbom.cdx.json
    SAVE ARTIFACT sbom.cdx.json AS LOCAL sbom.cdx.json

ci-all:
    ARG VERSION=dev
    BUILD +ci
    BUILD +sbom
    BUILD image+dev --VERSION=${VERSION}
